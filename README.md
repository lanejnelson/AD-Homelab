# AD-Homelab
Microsoft Active Directory is a feature-rich, centralized directory service used to manage and organize network resources, primarily in Windows environments. Active Directory (AD) can be used to allow users to access different workstations using the same user account, let system administrators remotely configure system settings, and much more. AD can be used standalone, or alongside other services on a Windows Server machine. It is integral to many organizations and critical infrastructure and is used by over 95% of the Fortune 500 and provides critical services and infrastructure used in these companies. Active Directory skills are important for any sysadmins or cybersecurity enthusiasts due to the large userbase. With all that said, lets get into the setup of a home lab that you can use for practicing attacks or as a project to display your skills.



## Necessary Software
To set up this home lab, we're going to need a few things. The first is the ISO image for Windows Server 2019 which you can download [here](https://www.microsoft.com/en-us/evalcenter/download-windows-server-2019), and the Windows 10 ISO which you can download using the media creation tool [here.](https://www.microsoft.com/en-us/software-download/windows10) Next, you'll need a hypervisor of your choice. I'd recommend [VMWare Workstation](https://www.vmware.com/products/workstation-pro/workstation-pro-evaluation.html) and I used it in this guide, but [Oracle Virtualbox](https://www.virtualbox.org/wiki/Downloads) can also be used.

## Setting up the Windows Server VM
Once the ISOs are downloaded, and the hypervisor is installed, now it's time to setup the 1st virtual machine which will be the Domain Controller for Active Directory. Start up VMWare, and either click "Create a new virtual machine" from the home page, or go to File -> New Virtual Machine. Then, click the Typical option, then click Browse under "Installer disc image file" and find where you downloaded the ISO and select it then click next. On the next page, just click next as we aren't going to use Easy Install anyways as it breaks the installation process. Name the VM something appropriate and select the path where you want to put the VM files if the default won't work for you due to low space or similar reasons. For hard disk space, choose anything over 50 GB then click next. On the final page, uncheck "Power on this virtual machine after creation" and then click finish. Click on the virtual machine's name in the sidebar then click "Edit virtual machine settings." Remove the floppy disk drive by clicking it then clicking the remove button at the bottom. We are also going to add a new network adapter by clicking the Add button next to the remove button, clicking "Network Adapter", then clicking Finish. Set the Network Adapter to Custom, then VMnet1 in the dropdown. Change the CPU options and memory options to what your computer can support. I recommend to use at least 4GB of RAM and 2 CPU cores. Now close the config box and start the virtual machine. Go through the installation process by clicking "Install Now" and then clicking either Standard or Datacenter but make sure it says (Desktop Experience) after it then click next. Click custom install and then next and the installation should start.

## Windows Server Configuration
When the VM starts back up, log in and you'll be put onto the Desktop. To make sure that the VM has an easy hostname, go to File Explorer, then right click on This PC, and click properties. That should open the Settings app, so scroll down and click "Rename this PC (Advanced)" This will open a new window. Click Change and then change the Computer name to something recognizable like "DC01" or "DC". Click OK, then reboot. Log back in and open Control Panel -> Network and Internet -> Network and Sharing Center -> Change Adapter Settings. This should show 2 network adapters - one that says "Network" and one that says "Unidentified network". Right click and rename the one that says "Network" and call it "Internet" and do the same to the other but call it "#Internal". The "Internet" adapter is how Windows Server accesses the outside internet, and "Internal" is going to be the local network used by the Windows 10 client and the Windows Server box. Double click on #Internal, click Properties, select IPV4, then click Properties. Check "Use the follow IP address" then put `172.16.0.1` as the IP, `255.255.255.0` as the Subnet mask, and leave Default gateway as blank. Check "Use the following DNS server addresses" and put `127.0.0.1` as the Preffered DNS server and leave the other blank. Click OK, and close out of Control Panel.

Open Server Manager, click Manage at the top, then click Add Roles and Features. Click Next until you reach "Server Roles". Select Active Directory Domain Services then Add Features, then click Next. Then click Next twice, and then click Install. When it finishes, click Close and then go back to Server Manager and click on the flag and select "Promote this server to a domain controller." Check "Add a new forest" and then put any domain name that you can easily remember like "mydomain.com". Click next, Uncheck DNS Server and then enter a password that you can remember in the boxes and click Next. Click Next when it shows you the domain name, click Next on Paths, Review Options, Prerequisites Check  and then click Install. When it's done, restart. Now when you login, it should show you logging into YOURDOMAIN\Administrator instead of just Administrator. This means Active Directory is installed and working. 

Go to Server Manager, Tools, and then Active Directory Users and Computers. Expand mydomain.com, then right click and select New -> Organzational Unit. Call it Admins and then click OK. Right click on this group, select New -> User, and create a user with any name you want, but with the user logon name of a- +first initial+ last name. This will be your domain admin user that you will use from now on. Follow the prompts and deselect "User must change password at next logon" and select "Password never expires." Double click on the user, click on the Member of tab, then click Add, then type in "Domain Admins", then click Check Names and hit OK. Now log out and click other user and log into this new user.

Go back to Server Manager -> Add Roles and Features, then click Next until you get to Server Roles. Select Remote Access and then click Next. Click Next, Next, and then click Routing and Add Features, then click Next, Next, and Next, then click Install. When it's done, click Close, go to Tools -> Routing and Remote Access. Right click on DC01, then click "Configure and Enable Routing and Remote Access." Click Next, select Network Address Translation (NAT), click Next, and then select "Use this public interface to connect to the Internet" and select the one you named "Internet" and click Next, and Finish. If it doesn't show up, click cancel, close the Routing application, and do the process again.

When it's finally done, go to Server Manager -> Manage -> Add Roles and Features again. Click Next until you reach Server Roles and select DHCP Server and click Add Features and then Next until you reach the install page and click Install. Go to Server Manager -> Tools -> DHCP then expand the Domain Controller, right click IPV4 then click on New Scope. Click Next and then enter the name which will 172.16.0.100-200 which is the range. Click next and enter `172.16.0.100` as the starting IP address and `172.16.0.200` as the ending IP address and `255.255.255.0` as the Subnet mask and click Next. There won't be any exclusions so click Next again. Keep the duration as default and click next. Keep the default checked and click Next to configure options. For the IP address for the router, enter `172.16.0.1` and click Next. If the domain is right on the next page, click Next. The next page doesn't matter so click Next. Then make sure Yes is selected to activate the scope and click Next and Finish. Right click on DC01 under DHCP and click Authorize. Then go to DC01 -> IPV4 -> Server Options and right click on it, click Configure Options, then select 003 Router, put `172.16.0.1` as the IP address and click OK and then your DHCP server should be all ready to serve out IP addresses.

Now the major configuration is all done and for an optional finishing touch, you just have to add Users. You can do this manually in Server Manager -> Tools -> Active Directory Users and Computers or you can use this [script.](https://github.com/joshmadakor1/AD_PS) This is very simple and you don't have to do it, but it does make it a bit more like a real Active Directory environment instead of an empty home lab. I would recommend creating at least one user aside from your Domain Admin account just so that the Windows 10 client has its own user account.

## Setting up the Windows 10 VM
This is very similar to the Windows Server VM setup but with a few minor changes, so I won't repeat myself too much. This VM obviously will use the Windows 10 ISO instead of the Windows Server ISO, and will only have the VMNet1 network adapter instead of the NAT one as well. During the installation, when you get asked for the version of Windows, select Windows 10 Pro (Without an N.) Follow the installation process as it asks you to create a user and any other prompts it may show. When it asks you to connect to the internet, click "I don't have internet" and ignore any prompts to connect to the internet. When it's done finally installing, go back to the VMWare home page in the program, go to Edit -> Virtual Network Editor. Towards the bottom, there will be a Change Settings button and you need to click that to configure options. Once you accept the Administrator prompt, click VMNet1 and disable "Use local DHCP service" as this will interfere with the Windows Server DHCP Server. Put `172.16.0.0` as the Subnet IP and `255.255.255.0` as the Subnet mask. Then click Apply and OK and go back to the VM for the next steps.

## Windows 10 Configuration
Log into the user you created while installing Windows and you should be dropped onto the Desktop. First thing we need to do is change the hostname of the VM. To do that, go to Settings -> System -> About -> Rename this PC (Advanced). Then click the Change button and change the computer name to something like "WS01" or "MS01" then reboot. Once the VM has restarted, we need to make sure we did everything correctly. To check if everything is configured properly, open up a command prompt and type `ipconfig` and hit enter. If it doesn't show an IP address that looks like 172.16.0.X, type `ipconfig /renew` and that may fix it. If it doesn't, retrace your steps as you may have made a mistake in the Windows Server section or Windows 10 setup section. If you have an IP address and the gateway is showing as "172.16.0.1" then you should be able to access the internet like normal and everything should be good. Now all we have to do is join the domain. Do the same steps that you did to change the hostname but instead of changing the computer name, select Domain under "Member of" and type whatever your domain name is. In my case, it is `mydomain.com`. It will prompt you for credentials so enter the credentials of your Domain Admin account that you set up earlier and if everything was done correctly, it should say "Welcome to mydomain" and prompt you to reboot. When the computer is rebooted, log in with the domain user you created at the end of configuring Windows Server and you should be dropped onto the Desktop after it sets up this new user.

